<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>K·∫øt qu·∫£ thanh to√°n</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <link rel="stylesheet" th:href="@{/css/pages.css}" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  </head>
  <body>
    <div th:replace="~{components/headbar :: headbar}"></div>

    <main class="container" style="max-width: 700px; margin: 60px auto; padding: 40px 20px;">
      <!-- Success Result -->
      <div th:if="${success}" class="result-container success-result">
        <div class="result-icon-wrapper">
          <div class="result-icon success-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="success-particles">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
        
        <h1 class="result-title">üéâ C·∫£m ∆°n b·∫°n r·∫•t nhi·ªÅu!</h1>
        
        <div class="result-message-box">
          <p class="result-message" th:text="${message}">
            Kho·∫£n ƒë√≥ng g√≥p c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω th√†nh c√¥ng.
          </p>
        </div>

        <div class="donation-summary" th:if="${amount != null}">
          <div class="summary-item">
            <span class="summary-label">S·ªë ti·ªÅn ƒë√£ ·ªßng h·ªô</span>
            <span class="summary-value" th:text="${#numbers.formatDecimal(amount, 0, 'COMMA', 0, 'POINT')} + ' ƒë'">0 ƒë</span>
          </div>
          <div class="summary-item" th:if="${paymentMethod != null}">
            <span class="summary-label">Ph∆∞∆°ng th·ª©c</span>
            <span class="summary-value" th:text="${paymentMethod}">MoMo ATM</span>
          </div>
          <div class="summary-item" th:if="${orderId != null}">
            <span class="summary-label">M√£ giao d·ªãch</span>
            <span class="summary-value code" th:text="${orderId}">ORDER123</span>
          </div>
        </div>

        <div class="thank-you-note">
          <i class="fas fa-heart"></i>
          <p>L√≤ng t·ªët c·ªßa b·∫°n s·∫Ω t·∫°o n√™n s·ª± kh√°c bi·ªát l·ªõn lao trong cu·ªôc s·ªëng c·ªßa nh·ªØng ng∆∞·ªùi c·∫ßn gi√∫p ƒë·ª°. Ch√∫ng t√¥i v√¥ c√πng bi·∫øt ∆°n s·ª± ƒë√≥ng g√≥p c·ªßa b·∫°n!</p>
        </div>

        <div class="result-actions">
          <a th:href="@{/campaign/{id}(id=${campaignId})}" class="btn btn-primary" th:if="${campaignId != null}">
            <i class="fas fa-arrow-left"></i>
            Quay l·∫°i chi·∫øn d·ªãch
          </a>
          <a th:href="@{/campaigns}" class="btn btn-secondary">
            <i class="fas fa-th-large"></i>
            Xem c√°c chi·∫øn d·ªãch kh√°c
          </a>
        </div>

        <div class="countdown-box">
          <i class="fas fa-clock"></i>
          <span>T·ª± ƒë·ªông chuy·ªÉn v·ªÅ chi·∫øn d·ªãch sau <strong id="countdown">5</strong> gi√¢y...</span>
        </div>
      </div>

      <!-- Error Result -->
      <div th:if="${!success}" class="result-container error-result">
        <div class="result-icon-wrapper">
          <div class="result-icon error-icon">
            <i class="fas fa-times-circle"></i>
          </div>
        </div>
        
        <h1 class="result-title">Thanh to√°n kh√¥ng th√†nh c√¥ng</h1>
        
        <div class="result-message-box error">
          <p class="result-message" th:text="${message}">
            ƒê√£ c√≥ l·ªói x·∫£y ra trong qu√° tr√¨nh thanh to√°n.
          </p>
        </div>

        <div class="error-help">
          <p><strong>B·∫°n c√≥ th·ªÉ:</strong></p>
          <ul>
            <li>Ki·ªÉm tra l·∫°i th√¥ng tin t√†i kho·∫£n/th·∫ª</li>
            <li>ƒê·∫£m b·∫£o t√†i kho·∫£n c√≥ ƒë·ªß s·ªë d∆∞</li>
            <li>Th·ª≠ l·∫°i v·ªõi ph∆∞∆°ng th·ª©c thanh to√°n kh√°c</li>
            <li>Li√™n h·ªá hotline: <strong>1900 xxxx</strong> n·∫øu c·∫ßn h·ªó tr·ª£</li>
          </ul>
        </div>

        <div class="result-actions">
          <a th:href="@{/campaign/{id}(id=${campaignId})}" class="btn btn-primary" th:if="${campaignId != null}">
            <i class="fas fa-redo"></i>
            Th·ª≠ l·∫°i
          </a>
          <a th:href="@{/campaigns}" class="btn btn-secondary">
            <i class="fas fa-home"></i>
            V·ªÅ trang ch·ªß
          </a>
        </div>

        <div class="countdown-box">
          <i class="fas fa-clock"></i>
          <span>T·ª± ƒë·ªông chuy·ªÉn v·ªÅ chi·∫øn d·ªãch sau <strong id="countdown">5</strong> gi√¢y...</span>
        </div>
      </div>
    </main>

    <script th:src="@{/js/headbar.js}"></script>
    <script th:inline="javascript">
      /*<![CDATA[*/
      const campaignId = /*[[${campaignId}]]*/ null;
      const success = /*[[${success}]]*/ false;
      
      // Countdown and redirect
      let countdown = 5;
      const countdownElement = document.getElementById('countdown');
      
      const interval = setInterval(() => {
        countdown--;
        if (countdownElement) {
          countdownElement.textContent = countdown;
        }
        
        if (countdown <= 0) {
          clearInterval(interval);
          if (campaignId) {
            window.location.href = '/campaign/' + campaignId;
          } else {
            window.location.href = '/campaigns';
          }
        }
      }, 1000);
      /*]]>*/
    </script>

    <style>
      .result-container {
        text-align: center;
        padding: 40px 20px;
        animation: fadeIn 0.5s ease;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .result-icon-wrapper {
        position: relative;
        display: inline-block;
        margin-bottom: 30px;
      }

      .result-icon {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
        animation: scaleIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      }

      @keyframes scaleIn {
        0% { transform: scale(0) rotate(-180deg); }
        100% { transform: scale(1) rotate(0deg); }
      }

      .success-icon {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      }

      .error-icon {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      }

      .result-icon i {
        font-size: 60px;
        color: white;
      }

      .success-particles span {
        position: absolute;
        width: 10px;
        height: 10px;
        background: #10b981;
        border-radius: 50%;
        animation: particle 1.5s ease-out forwards;
      }

      .success-particles span:nth-child(1) { top: 0; left: 50%; animation-delay: 0.1s; }
      .success-particles span:nth-child(2) { top: 25%; right: 10%; animation-delay: 0.2s; }
      .success-particles span:nth-child(3) { bottom: 25%; right: 10%; animation-delay: 0.3s; }
      .success-particles span:nth-child(4) { bottom: 0; left: 50%; animation-delay: 0.4s; }
      .success-particles span:nth-child(5) { top: 25%; left: 10%; animation-delay: 0.5s; }

      @keyframes particle {
        0% { transform: translate(0, 0) scale(1); opacity: 1; }
        100% { transform: translate(var(--x, 50px), var(--y, -50px)) scale(0); opacity: 0; }
      }

      .result-title {
        font-size: 32px;
        font-weight: 800;
        color: #1f2937;
        margin: 0 0 20px 0;
      }

      .result-message-box {
        background: #f0fdf4;
        border: 2px solid #bbf7d0;
        border-radius: 16px;
        padding: 24px;
        margin: 0 0 30px 0;
      }

      .result-message-box.error {
        background: #fef2f2;
        border-color: #fecaca;
      }

      .result-message {
        font-size: 18px;
        color: #374151;
        line-height: 1.6;
        margin: 0;
      }

      .donation-summary {
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 16px;
        padding: 24px;
        margin: 0 0 30px 0;
      }

      .summary-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #f3f4f6;
      }

      .summary-item:last-child {
        border-bottom: none;
      }

      .summary-label {
        font-size: 14px;
        color: #6b7280;
        font-weight: 600;
      }

      .summary-value {
        font-size: 18px;
        color: #1f2937;
        font-weight: 700;
      }

      .summary-value.code {
        font-family: monospace;
        background: #f3f4f6;
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 14px;
      }

      .thank-you-note {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        border: 2px solid #fbbf24;
        border-radius: 16px;
        padding: 24px;
        margin: 0 0 30px 0;
        text-align: left;
      }

      .thank-you-note i {
        font-size: 24px;
        color: #f59e0b;
        margin-bottom: 12px;
      }

      .thank-you-note p {
        margin: 0;
        color: #78350f;
        font-size: 15px;
        line-height: 1.7;
      }

      .error-help {
        background: #f9fafb;
        border-radius: 12px;
        padding: 20px;
        margin: 0 0 30px 0;
        text-align: left;
      }

      .error-help ul {
        margin: 12px 0 0 0;
        padding-left: 20px;
      }

      .error-help li {
        margin: 8px 0;
        color: #4b5563;
      }

      .result-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 30px;
      }

      .btn {
        padding: 14px 32px;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
      }

      .btn-secondary {
        background: white;
        color: #374151;
        border: 2px solid #e5e7eb;
      }

      .btn-secondary:hover {
        background: #f9fafb;
        border-color: #d1d5db;
      }

      .countdown-box {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-size: 14px;
        color: #6b7280;
        margin-top: 20px;
      }

      .countdown-box i {
        color: #10b981;
      }

      .countdown-box strong {
        color: #10b981;
        font-size: 18px;
      }

      @media (max-width: 640px) {
        .result-title {
          font-size: 24px;
        }

        .result-icon {
          width: 100px;
          height: 100px;
        }

        .result-icon i {
          font-size: 50px;
        }

        .result-actions {
          flex-direction: column;
        }

        .btn {
          width: 100%;
          justify-content: center;
        }
      }
    </style>
  </body>
</html>

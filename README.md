# Web Từ Thiện – Spring Boot + Microservices

Project skeleton generated by assistant. Stack:
- Java 17, Spring Boot
- Maven
- MySQL (Docker)
- Microservices Architecture
- Docker & Kubernetes

## Docker Compose (Khuyến nghị cho Development)

### Yêu cầu
- Docker Desktop (https://www.docker.com/products/docker-desktop)
- Docker Compose (đã tích hợp trong Docker Desktop)

### Cài đặt và chạy

```powershell
# Build và start tất cả services (MySQL + Web App + REST API)
docker-compose up --build

# Chạy ở chế độ background
docker-compose up -d

# Xem logs
docker-compose logs -f

# Stop tất cả services
docker-compose down

# Stop và xóa volumes (dữ liệu MySQL)
docker-compose down -v
```

### Services
- **MySQL**: `localhost:3307` (container tự động khởi động)
- **Web App**: `http://localhost:8080`
- **REST API**: `http://localhost:8081`

### Credentials
- MySQL User: `app_user`
- MySQL Password: `app_password`
- MySQL Database: `web_tu_thien`

### Lưu ý
- Data được lưu trong Docker volume `mysql_data`
- Không mất data khi restart container
- Chỉ mất data khi chạy `docker-compose down -v`

## Kubernetes (Production & Scaling)

### Yêu cầu
- Minikube hoặc Docker Desktop with Kubernetes
- kubectl CLI

### Cài đặt Minikube (Windows)

```powershell
# Cài Chocolatey (nếu chưa có)
Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

# Cài Minikube
choco install minikube

# Cài kubectl
choco install kubernetes-cli

# Start Minikube
minikube start --driver=docker
```

### Build Docker Images cho Kubernetes

```powershell
# Set Docker environment to Minikube
& minikube -p minikube docker-env --shell powershell | Invoke-Expression

# Build images
docker build -t web-tu-thien-webapp:latest -f Dockerfile.webapp .
docker build -t web-tu-thien-restapi:latest -f Dockerfile.restapi .
```

### Deploy lên Kubernetes

```powershell
# Apply tất cả manifests
kubectl apply -f k8s/mysql-deployment.yaml
kubectl apply -f k8s/webapp-deployment.yaml
kubectl apply -f k8s/restapi-deployment.yaml

# Kiểm tra deployments
kubectl get deployments
kubectl get pods
kubectl get services

# Xem logs
kubectl logs -f deployment/webapp
kubectl logs -f deployment/restapi

# Access services
minikube service webapp
minikube service restapi
```

### Scaling

```powershell
# Scale webapp
kubectl scale deployment webapp --replicas=3

# Scale restapi
kubectl scale deployment restapi --replicas=3

# Xem status
kubectl get pods -w
```

### Update và Rolling Update

```powershell
# Rebuild image (sau khi code thay đổi)
docker build -t web-tu-thien-webapp:latest -f Dockerfile.webapp .

# Rolling update
kubectl rollout restart deployment/webapp

# Kiểm tra rollout status
kubectl rollout status deployment/webapp

# Rollback nếu cần
kubectl rollout undo deployment/webapp
```

### Monitoring

```powershell
# Dashboard
minikube dashboard

# Resource usage
kubectl top nodes
kubectl top pods

# Describe resources
kubectl describe deployment webapp
kubectl describe service webapp
```

### Clean up

```powershell
# Xóa tất cả resources
kubectl delete -f k8s/

# Hoặc xóa từng loại
kubectl delete deployment webapp restapi mysql
kubectl delete service webapp restapi mysql
kubectl delete pvc mysql-pvc
kubectl delete secret mysql-secret

# Stop Minikube
minikube stop

# Delete cluster
minikube delete
```

## Kiến trúc Microservices

```
┌─────────────┐     ┌─────────────┐
│   Web App   │────▶│   REST API  │
│   :8080     │     │   :8081     │
└──────┬──────┘     └──────┬──────┘
       │                   │
       └───────┬───────────┘
               │
        ┌──────▼──────┐
        │    MySQL    │
        │    :3306    │
        └─────────────┘
```

## So sánh Docker Compose vs Kubernetes

| Feature | Docker Compose | Kubernetes |
|---------|----------------|------------|
| **Use Case** | Development local | Production, scaling |
| **Setup** | Đơn giản | Phức tạp hơn |
| **Scaling** | Manual | Auto-scaling |
| **Load Balancing** | Không | Có sẵn |
| **High Availability** | Không | Có |
| **Rolling Updates** | Không | Có |

## Tips

- ✅ Dùng `docker-compose` cho development (nhanh, đơn giản)
- ✅ Dùng `Kubernetes` cho production (scaling, HA, monitoring)
- ✅ Health checks đã được config sẵn
- ⚠️ Thay đổi database credentials trong production
- ✅ Sử dụng ConfigMaps và Secrets cho configuration management


